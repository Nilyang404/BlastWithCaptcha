# BlastWithCaptcha

[![OSCS Status](https://www.oscs1024.com/platform/badge/AbelChe/BlastWithCaptcha.svg?size=large)](https://www.oscs1024.com/project/AbelChe/BlastWithCaptcha?ref=badge_large)

Blasting requests with captcha authentication

A fork of [BlastWithCaptcha](https://github.com/AbelChe/BlastWithCaptcha). Fixed some issues to make it work, and  updated and optimized with multithreading and distributed support, for specific projects, you still need to modify the configuration file to make it work.


- Local OCR [ddddocr](https://github.com/sml2h3/ddddocr)
- Multithreading
- Support payload custom secondary processing (plug-in)
- Support using id to check the type of captcha

## Features
- Applicable to a strict Captcha system (Captcha is generated by the server and stores the verification ID, which also expires immediately after the Captcha verification attempt)
- **Support multi-threaded or distributed systems**
- The OCR model can be trained for a specific captcha generator to improve the recognition success rate
- Applicable to various forms of Captcha

## How to use

1. Pull and configure the environment
```shell
cd BlastWithCaptcha
pip install -r requirements.txt -i
```


2. Request file

Take account and password login authentication as an example

- blast.txt

Copy the login request package from tools such as burpsuite to blast.txt

Mark the parameter position to be blasted in the get or post parameter, as shown below, blast username password and verification code validCode

Use the `$<index>$` mark. Note that the order of the config.yaml dictionary list needs to be set according to the order of index

When setting the dictionary list, the verification code position can be ignored and postponed

Here, the corresponding relationship between the positions 1 2 3: 1 and 2 correspond to `target.WORDDICT_LIST` in config.yml, and 3 corresponds to `target.CAPTCHA_INDEX`

```
POST /api/login HTTP/1.1
Host: example.com.test
Cookie: SESSION=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Content-Length: 61
Sec-Ch-Ua: " Not A;Brand";v="99", "Chromium";v="102", "Microsoft Edge";v="102"
Accept: application/json, text/plain, */*
Content-Type: application/json;charset=UTF-8
Sec-Ch-Ua-Mobile: ?0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36
Sec-Ch-Ua-Platform: "macOS"
Origin: https://example.com.test
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://example.com.test/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6
Connection: close

{"username":"$<1>$","password":"$<2>$","validCode":"$<3>$"}
```

- captcha.txt

Just copy the data packet requesting the verification code in burpsuite

```
GET /captcha.jpg HTTP/1.1
Host: example.com.test
Cookie: SESSION=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Sec-Ch-Ua: " Not A;Brand";v="99", "Chromium";v="102", "Microsoft Edge";v="102"
Sec-Ch-Ua-Mobile: ?0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36
Sec-Ch-Ua-Platform: "macOS"
Accept: image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: no-cors
Sec-Fetch-Dest: image
Referer: https://example.com.test/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6
Connection: close


```

In addition, **no** need to consider the cookie correspondence between `blast.txt` and `captcha.txt`, the program will automatically generate a new session



3. config

`config.yml`

```yaml
system:
PROXY: # Uplink proxy, for example 127.0.0.1:8080
REQUEST_RETRIES: 5 # Request retries
ONCETIME_THREAD_POOL_SIZE: 1 # Concurrency
THREAD_POOL_SIZE: 10 # Maximum number of threads in the thread pool
TRYAGAIN_TIMES: 3 # Number of retries for verification code recognition failure
USERAGENT: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 #Custom user-agent
LFLAG: '$<' #Left sign symbol
RFLAG: '>$' #Right sign symbol
SSL_VERIFY: FALSE #Requests verify configuration, default is OK

ocr:
CAPTCHA_REGEX: '.*(\w{4})' #Extract the results of ocr recognition, for example .*(\w{4}) .*(\d{4}) (.*?) ......
CAPTCHA_REGEX_GETVALUE_INDEX: 1 #Use with CAPTCHA_REGEX to get the position of its regular expression result, starting from 1

target:
BLAST: blast.txt #Blast request text file, default is OK
CAPTCHA: captcha.txt # Verification code request text file, the default is ok
CAPTCHA_LENGTH: 4 # Verification code digits, used to identify whether the OCR recognition result is accurate or not, for example 4 6...... If set to 0, the verification code digits are not verified
CAPTCHA_DATATYPE: CUSTOM # Verification code return data type, you can choose original image: RAW base64 encoding: BASE64 custom data acquisition: CUSTOM
CAPTCHA_CUSTOM_GETFLAG: 'code"\:"(.*?)"' # Used with CAPTCHA_DATATYPE value of CUSTOM, regular expression to extract data
CAPTCHA_ID_INDEX: 4 # Verification code id position, flag bit starts from 1
CAPTCHA_ID_GETFLAG: '"codeId"\:"(.*?)"' # Regular expression to extract verification code id
CAPTCHA_INDEX: 3 # Verification code position, flag bit starts from 1
WORDDICT_LIST: # Dictionary settings, please note that the order corresponds to the order marked in the BLAST file
-
file: /Users/AbelChe/SecTools/worddicts/fuzzDicts/userNameDict/top500.txt # Dictionary file location
plugin: # payload plugin configuration array format leave it blank to use the original dictionary data
- ['upper']
-
file: /Users/AbelChe/SecTools/worddicts/Blasting_dictionary/top100password.txt # Dictionary file location
plugin: # payload plugin configuration array format
- ['md5'] # The format is [plugin name (corresponding to the file name in the plugins directory), parameter 1, parameter 2, ......] The parameter should correspond to args=[] in the plugin code, and the mapping relationship is args=[parameter 1, parameter 2, ......]
- ['suffix', 'xxxxxxxxxx']
SSL: False # Use https or not
CAPTCHA_ERROR_FLAG: # Text flag for judging verification code error, regular expression
- Verification code error
- Please enter the correct verification code
- Verification code abnormality
CAPTCHA_ERROR_CODE: # Status code for judging verification code error
- 500
- 502
- 403
LOGIN_ERROR_FLAG: # Flag for judging authentication failure, regular expression
- Account does not exist or password is wrong
LOGIN_ERROR_CODE: # Status code for judging authentication failure
LOGIN_SUCCESS_FLAG: # Text flag for judging successful login, regular expression
- Login successful
LOGIN_SUCCESS_CODE: # Status code for judging successful login

```


4. Start
with python version >=3.7

```shell
python BlastWithCaptcha.py
```



## Reference
- https://github.com/AbelChe/BlastWithCaptcha
- [https://github.com/sml2h3/ddddocr](https://github.com/sml2h3/ddddocr)
- https://github.com/psf/requests
- https://github.com/requests/toolbelt
